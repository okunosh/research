
import pandas as pd
import os

def save_max_min_info_to_csv(output_csv_path, dir_path, u_info, theta_info):
    """
    最大・最小情報をCSVに保存する関数（追記モード）

    Parameters
    ----------
    output_csv_path : str
        書き込み先CSVファイルのパス
    dir_path : str
        処理対象データのディレクトリパス（キー）
    u_info : dict
        "u"の最大・最小情報（get_max_min_info()の返り値）
    theta_info : dict
        "theta"の最大・最小情報（同上）
    """

    row = {
        "directory": dir_path,

        "u_max_value": u_info["max_value"],
        "u_t_at_max": u_info["t_at_max"],
        "u_altitude_at_max": u_info["altitude_at_max"],
        "u_min_value": u_info["min_value"],
        "u_t_at_min": u_info["t_at_min"],
        "u_altitude_at_min": u_info["altitude_at_min"],

        "theta_max_value": theta_info["max_value"],
        "theta_t_at_max": theta_info["t_at_max"],
        "theta_altitude_at_max": theta_info["altitude_at_max"],
        "theta_min_value": theta_info["min_value"],
        "theta_t_at_min": theta_info["t_at_min"],
        "theta_altitude_at_min": theta_info["altitude_at_min"],
    }

    # DataFrame化して1行として保存（追記）
    df_new = pd.DataFrame([row])

    if os.path.exists(output_csv_path):
        df_existing = pd.read_csv(output_csv_path)
        df_combined = pd.concat([df_existing, df_new], ignore_index=True)
        df_combined.to_csv(output_csv_path, index=False)
    else:
        df_new.to_csv(output_csv_path, index=False)
